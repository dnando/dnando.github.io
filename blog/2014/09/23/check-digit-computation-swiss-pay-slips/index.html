
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Check Digit Computation for Swiss Pay Slips - Nando @ Aria Media</title>
  <meta name="author" content="Nando @ Aria Media">

  
  <meta name="description" content="I&rsquo;m working on a business application that generates invoices and pay slips for a company in Switzerland. Instead of checks, the Swiss banking &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://dnando.github.io/blog/2014/09/23/check-digit-computation-swiss-pay-slips">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Nando @ Aria Media" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='//fonts.googleapis.com/css?family=Oxygen:400,300,700' rel='stylesheet' type='text/css'>

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Nando @ Aria Media</a></h1>
  
    <h2>( learning Clojure ColdFusion Railo Javascript jQuery Angular CSS Linux Apache HTML5 & etc )</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:dnando.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about-me">About Me</a></li>
  <li><a href="http://aria-media.com/">Aria Media</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Check Digit Computation for Swiss Pay Slips</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-09-23T13:50:02+02:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>23</span><span class='date-suffix'>rd</span>, <span class='date-year'>2014</span></span> <span class='time'>1:50 pm</span></time>
        
           | <a href="#disqus_thread"
             data-disqus-identifier="http://dnando.github.io">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>I&rsquo;m working on a business application that generates invoices and pay slips for a company in Switzerland. Instead of checks, the Swiss banking system uses a pay slip, and these have an account number, a reference number and of course the total which should be paid, all with check digits, similar to what is found on credit card numbers. At first I thought the check digit was generated by the <a href="http://en.wikipedia.org/wiki/Luhn_algorithm">Luhn algorithm</a>, for which I could find plentiful examples, even in ColdFusion, such as <a href="http://www.danvega.org/blog/2009/9/3/Using-ColdFusion-to-generate-credit-card-numbers">Dan Vega&rsquo;s post</a> explaining how to generate credit card numbers with correct check digits. The meat of his implementation is here, which expects an array, ccnumber, with the card number in it and and cclen, which is of course <code>arrayLen( ccnumber )</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='cfc'><span class='line'><span class="o">&lt;</span><span class="nv">cfscript</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="cm">/* the luhn Algorithm is used to create the check digit number */</span>
</span><span class='line'>  <span class="k">var</span> <span class="nv">sum</span> <span class="o">=</span> <span class="m">0</span><span class="p">;</span>
</span><span class='line'>  <span class="k">for</span><span class="p">(</span><span class="nv">j</span><span class="o">=</span><span class="m">1</span><span class="p">;</span> <span class="nv">j</span> <span class="o">&lt;</span> <span class="nv">cclen</span><span class="p">;</span> <span class="nv">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">var</span> <span class="nv">digit</span> <span class="o">=</span> <span class="nv">ccnumber</span><span class="p">[</span><span class="nv">j</span><span class="p">];</span>
</span><span class='line'>      <span class="c1">// length of 16 for Visa|Mastercard|Discover &amp;&amp; length of 15 for Amex</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="nv">cclen</span> <span class="o">==</span> <span class="m">16</span> <span class="o">&amp;&amp;</span> <span class="nv">j</span> <span class="err">%</span> <span class="m">2</span> <span class="o">!=</span> <span class="m">0</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nv">cclen</span> <span class="o">==</span> <span class="m">15</span> <span class="o">&amp;&amp;</span> <span class="nv">j</span> <span class="err">%</span> <span class="m">2</span> <span class="o">==</span> <span class="m">0</span><span class="p">)</span> <span class="p">){</span>
</span><span class='line'>          <span class="nv">digit</span> <span class="o">=</span> <span class="nv">digit</span> <span class="o">*</span> <span class="m">2</span><span class="p">;</span>
</span><span class='line'>          <span class="k">if</span><span class="p">(</span><span class="nv">digit</span> <span class="o">&gt;</span> <span class="m">9</span><span class="p">){</span>
</span><span class='line'>              <span class="nv">digit</span> <span class="o">=</span> <span class="p">(</span> <span class="nf">left</span><span class="p">(</span><span class="nv">digit</span><span class="p">,</span><span class="m">1</span><span class="p">)</span> <span class="o">+</span> <span class="nf">right</span><span class="p">(</span><span class="nv">digit</span><span class="p">,</span><span class="m">1</span><span class="p">)</span> <span class="p">);</span>
</span><span class='line'>          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>              <span class="nv">digit</span> <span class="o">=</span> <span class="nv">digit</span><span class="p">;</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="nv">sum</span> <span class="o">+=</span> <span class="nv">digit</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">var</span> <span class="nv">check_digit</span> <span class="o">=</span> <span class="p">[</span><span class="m">0</span><span class="p">,</span><span class="m">9</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">1</span><span class="p">];</span>
</span><span class='line'>  <span class="nv">ccnumber</span><span class="p">[</span><span class="nv">cclen</span><span class="p">]</span> <span class="o">=</span> <span class="nv">check_digit</span><span class="p">[(</span><span class="nv">sum</span> <span class="err">%</span> <span class="m">10</span> <span class="o">+</span> <span class="m">1</span><span class="p">)];</span>
</span><span class='line'><span class="o">&lt;/</span><span class="nv">cfscript</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>I was hoping I could quickly adapt the above for my use case. However, I was disappointed to learn that Swiss pay slips use a non-standard algorithm to calculculate check digits. And genuinely disheartened when I was left staring at this explanation of the algorithm, the only one that seems to be provided by the banking sector.</p>

<p><img src="/images/CheckDigit.gif" alt="Check digit computation module 10, recursive" /></p>

<p>If you study it for a few minutes, you&rsquo;ll see how the check digit is calculated, using the chart provided. But it doesn&rsquo;t give much of a clue what algorithm should be used to generate the check digit, except in the title, which seems to suggest it might use mod 10, recursively, if you assume that it has been translated from German incorrectly, module instead of modulo or modulus.</p>

<p>After a few sessions of Googling, I found an <a href="http://delphi.cjcsoft.net/viewthread.php?tid=48934">example someone wrote in Delphi</a> that seemed to demonstate it could be tackled rather simply, with a single array representing the entire chart. Unfortunately I couldn&rsquo;t grok some of the nuances of the syntax.</p>

<p>Then I ran across <a href="http://www.hosang.ch/modulo10.aspx">another set of examples</a> variations of C and Visual Basic. His comment at the top of the page reads:</p>

<p>Haben Sie sich auch schon über die nicht sehr programmiergerechte Beschreibung in den Unterlagen der PostFinance und der Telekurs geärgert? &hellip; which my Swiss client on this project translated as &ldquo;The descriptions from PostFinance and Telekurs are shit&hellip;&rdquo; - not at all useful for programmers.</p>

<p>The VB example looked familiar enough, and after a bit of mucking around, came up with this CFML function that seems to work to generate the check digit, passing every test I&rsquo;ve thown at it from the pay slips I have laying around.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='cfc'><span class='line'><span class="o">&lt;</span><span class="nv">cfscript</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="nv">public</span> <span class="k">numeric</span> <span class="k">function</span> <span class="nf">calCheckDigit</span><span class="p">(</span> <span class="k">string</span> <span class="nv">number</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">var</span> <span class="nv">arrTable</span> <span class="o">=</span> <span class="p">[</span><span class="m">0</span><span class="p">,</span><span class="m">9</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">5</span><span class="p">];</span>
</span><span class='line'>      <span class="k">var</span> <span class="nv">carry</span> <span class="o">=</span> <span class="m">0</span><span class="p">;</span>
</span><span class='line'>      <span class="k">var</span> <span class="nv">i</span> <span class="o">=</span> <span class="m">1</span><span class="p">;</span>
</span><span class='line'>      <span class="k">for</span> <span class="p">(</span> <span class="nv">i</span> <span class="o">=</span> <span class="m">1</span><span class="p">;</span> <span class="nv">i</span> <span class="o">&lt;=</span> <span class="k">len</span><span class="p">(</span> <span class="nv">number</span> <span class="p">);</span> <span class="nv">i</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="nv">carry</span> <span class="o">=</span> <span class="nv">arrTable</span><span class="p">[</span> <span class="p">(</span> <span class="p">(</span> <span class="nv">carry</span> <span class="o">+</span> <span class="nf">mid</span><span class="p">(</span> <span class="nv">number</span><span class="p">,</span> <span class="nv">i</span><span class="p">,</span> <span class="m">1</span> <span class="p">)</span> <span class="p">)</span> <span class="err">%</span> <span class="m">10</span> <span class="p">)</span> <span class="o">+</span> <span class="m">1</span> <span class="p">];</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">return</span> <span class="p">(</span> <span class="m">10</span> <span class="o">-</span> <span class="nv">carry</span> <span class="p">)</span> <span class="err">%</span> <span class="m">10</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'> <span class="o">&lt;/</span><span class="nv">cfscript</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>If you compare the VB solution with the above, you&rsquo;ll see I&rsquo;m adding 1 to each calculated index value. That&rsquo;s because ColdFusion arrays are 1-based rather than 0-based. If you happen to be using this example to build a similar function in another language that has 0 based arrays, remove the <code>+ 1</code> from line 7.</p>

<p>This function expects a string with consecutive numeric digits 0-9 only. It will blow up if any other characters are passed into it.</p>

<p>Here are some reference links for solving the more general problem of generating Swiss payment slips:</p>

<p><a href="https://www.postfinance.ch/binp/postfinance/public/dam.M26m_i6_6ceYcN2XtAN4w8OHMynQG7FKxJVK8TtQzr0.spool/content/dam/pf/de/doc/consult/manual/dlserv/inpayslip_isr_man_en.pdf">Manual ISR - Orange Inpayment Slip with reference number</a> - the clearest explanation I&rsquo;ve found regarding how the data is structured and placed on the pay slip.</p>

<p><a href="https://www.postfinance.ch/binp/postfinance/public/dam.kDeM1NfdktHxsoPgqxBgbWOwXjqUmZZMUW52ZpIhfU0.spool/content/dam/pf/de/doc/consult/manual/dldata/efin_recdescr_man_en.pdf">Record Description Electronic services</a> - the only information currently here is reproduced in the logic diagram above.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Nando @ Aria Media</span></span>

      




<time class='entry-date' datetime='2014-09-23T13:50:02+02:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>23</span><span class='date-suffix'>rd</span>, <span class='date-year'>2014</span></span> <span class='time'>1:50 pm</span></time>
      


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://dnando.github.io/blog/2014/09/23/check-digit-computation-swiss-pay-slips/" data-via="dnando" data-counturl="http://dnando.github.io/blog/2014/09/23/check-digit-computation-swiss-pay-slips/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2014/09/17/documentation-for-cfscript/" title="Previous Post: Documentation for CFScript">&laquo; Documentation for CFScript</a>
      
      
        <a class="basic-alignment right" href="/blog/2014/10/17/is-this-acceptable/" title="Next Post: Is This Acceptable?">Is This Acceptable? &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/01/15/nginx-tweaks-using-proxy-redirect-and-rewrite-directives/">Nginx Tweaks Using Proxy_redirect and Rewrite Directives</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/01/15/utf-8-extended-character-file-names-in-railo/">UTF-8 Extended Character File Names in Railo</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/01/09/testing-nginx-config-directives/">Testing Nginx Config Directives</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/01/08/railo-i-o-functions-in-utf-8/">Getting Railo I/O Functions to Work With Utf-8 File Names</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/01/08/cannot-find-template-cf11/">Cannot Find Template CF11</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/dnando">@dnando</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'dnando',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Nando @ Aria Media -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'nandoariamedia';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://dnando.github.io/blog/2014/09/23/check-digit-computation-swiss-pay-slips/';
        var disqus_url = 'http://dnando.github.io/blog/2014/09/23/check-digit-computation-swiss-pay-slips/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
