
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Nando @ Aria Media</title>
  <meta name="author" content="Nando @ Aria Media">

  
  <meta name="description" content="When using an SQL IN statement within a ColdFusion query, it is necessary to add the attribute list="true" to the param used for the list. See the &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://dnando.github.io">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Nando @ Aria Media" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='//fonts.googleapis.com/css?family=Oxygen:400,300,700' rel='stylesheet' type='text/css'>

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Nando @ Aria Media</a></h1>
  
    <h2>( learning Clojure ColdFusion Lucee Javascript jQuery Angular CSS Linux Apache HTML5 & etc )</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:dnando.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about-me">About Me</a></li>
  <li><a href="http://aria-media.com/">Aria Media</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/04/09/cfqueryparam-setting-for-sql-in-statements/">Cfqueryparam Setting for SQL &#8216;in&#8217; Statements</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-04-09T01:32:33+02:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>9</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>1:32 am</span></time>
        
           | <a href="/blog/2017/04/09/cfqueryparam-setting-for-sql-in-statements/#disqus_thread"
             data-disqus-identifier="http://dnando.github.io/blog/2017/04/09/cfqueryparam-setting-for-sql-in-statements/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>When using an SQL IN statement within a ColdFusion query, it is necessary to add the attribute <code>list="true"</code> to the param used for the list. See the example below that selects all employees that have a birthdate in March, April or May.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>var params = {};
</span><span class='line'>var monthList = "3,4,5";
</span><span class='line'>params.insert( "monthList", { value: ml, cfsqltype="CF_SQL_INTEGER", list="true" } );
</span><span class='line'>var sql = "
</span><span class='line'>  select employeeId, firstName, lastName, birthdate
</span><span class='line'>  from Employee
</span><span class='line'>  where month( birthdate ) in ( :monthList )
</span><span class='line'>";
</span><span class='line'>var q = queryExecute( sql, params );</span></code></pre></td></tr></table></div></figure>


<p>Thanks to Ben Nadel&rsquo;s post <a href="https://www.bennadel.com/blog/425-coldfusion-cfqueryparam-list-attribute-is-sweeet.htm">here</a> for this crucial tidbit of information!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/03/20/hot-browser-reloading/">Hot Browser Reloading With Browsersync</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-03-20T00:06:28+01:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>20</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>12:06 am</span></time>
        
           | <a href="/blog/2017/03/20/hot-browser-reloading/#disqus_thread"
             data-disqus-identifier="http://dnando.github.io/blog/2017/03/20/hot-browser-reloading/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&rsquo;ve fallen down the rabbit hole of front end development in the last few weeks, and in that time <a href="https://css-tricks.com/snippets/css/a-guide-to-flexbox/">Flexbox CSS</a>, <a href="http://blog.getbootstrap.com/2017/01/06/bootstrap-4-alpha-6/">Bootstrap v4</a>, <a href="http://foundation.zurb.com/">Foundation</a>, <a href="http://sass-lang.com/guide">Sass / SCSS</a>, and <a href="http://gulpjs.com/">Gulp</a> have all whizzed by as I&rsquo;ve taught myself portions of each, and today I landed at the bottom, <a href="https://www.browsersync.io/">Browsersync</a>.</p>

<p>In a nutshell, Browsersync will live reload one or more browsers for you whenever your project&rsquo;s files change. It will also live reload external devices pointed at the same web application. This allows you to simultaneously and efficiently test a responsive design in multiple browsers, phones and tablets - without needing to touch or reload any of them. It also synchronizes form entries and clicks across browsers and devices. For example, with my phone and tablet connected to Browsersync, I log into the app I&rsquo;m developing on the tablet, and my keystrokes and touch gestures are replicated on the phone, and I&rsquo;m logged in on both. Then I start navigating in the application in Chrome on my desktop, and the phone, tablet and other browsers follow as &ldquo;slaves&rdquo;. Interacting with any interface causes the rest of them to follow. What an incredible tool! In the few minutes I&rsquo;ve been experimenting with it, I was able to easily and quickly fix a layout issue on the tablet and phone for the login screen.</p>

<p>Browsersync works by wrapping your application or website in its own Node server process, on another port. You can start Browsersync on the command line, or via a Grunt or Gulp task. During startup, you specify the local url of your app, the files you want it to watch - a number of other options are possible - and then a browser window opens, on port 3000 by default, and browsersync is activated for that browser. To add others, you simply use the same url. To add external devices, on localhost:3001 there is an admin panel for Browsersync that will list the external url to use. Navigate to that external url on your phone or tablet or another computer, for me it currently <a href="http://192.168.1.103:3000/,">http://192.168.1.103:3000/,</a> and Browsersync is set up on these devices as well. Once you have it configured, it is really simple to use.</p>

<p>A quick overview on installation and configuration: Basic instructions are on the homepage <a href="https://www.browsersync.io/.">https://www.browsersync.io/.</a></p>

<ol>
<li>Install or upgrade Node.js</li>
<li>Install Browsersync using npm</li>
</ol>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>npm install -g browser-sync</span></code></pre></td></tr></table></div></figure>


<p>The -g flag means global so it is available from anywhere.</p>

<ol>
<li>Start Browsersync</li>
</ol>


<p>There are 2 start modes, &ndash;server and &ndash;proxy. <em>server</em> is for static files, <em>proxy</em> is for applications running on a server. Here&rsquo;s a simplified example starting Browsersync from the command line:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>browser-sync start --proxy "myproject.dev" --files "css/*.css"</span></code></pre></td></tr></table></div></figure>


<p>&hellip; assuming you have your local host file set up to point your app at myproject.dev. Or you can also start Browsersync using a localhost:port url, like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>browser-sync start --proxy "localhost:8500/myproject" --files "css/*.css"</span></code></pre></td></tr></table></div></figure>


<p>There are a few real world ways to do this, but what I&rsquo;ve done is to create a gulpfile.js in the root of my project so I can configure Browsersync conveniently and start it with a simple gulp command after cd&#8217;ing in to my project directory. That way I don&rsquo;t have to remember much. Here&rsquo;s my first working gulpfile.js for a real development scenario. I have ACF (Adobe ColdFusion) installed on port 8501 on my dev laptop, and  gulp.watch() is configured for an FW/1 app. I&rsquo;m not sure if I actually want to watch the controllers and services directories, perhaps the views directory and CSS directory is enough. But for now I will leave it like this and see how it goes.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>var gulp = require('gulp');
</span><span class='line'>var browserSync = require('browser-sync').create();
</span><span class='line'>var reload = browserSync.reload;
</span><span class='line'>
</span><span class='line'>gulp.task('browser-sync', function() {
</span><span class='line'>  browserSync.init({
</span><span class='line'>      proxy: "localhost:8501/myproject"
</span><span class='line'>  });
</span><span class='line'>
</span><span class='line'>  gulp.watch([
</span><span class='line'>      'controllers/*.cfc', 'services/*.cfc', 'views/**/*.cfm', 'dist/*.css'
</span><span class='line'>  ]).on("change", function() {
</span><span class='line'>      console.log("Watch hit");
</span><span class='line'>      browserSync.reload();
</span><span class='line'>  });
</span><span class='line'>});
</span><span class='line'>
</span><span class='line'>gulp.task('default', ['browser-sync']);</span></code></pre></td></tr></table></div></figure>


<p>Note carefully the syntax of gulp.watch() for multiple directories / files. It&rsquo;s an array of strings separated by commas. Note also that the root of the relative paths specified is where the gulpfile.js is located.</p>

<p>But wait, wouldn&rsquo;t it be better if I could use Browsersync to develop against both ACF and Lucee? Here&rsquo;s a solution that I have working that creates named instances of Browsersync so they don&rsquo;t step on each other:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>var gulp = require('gulp');
</span><span class='line'>var bsacf = require('browser-sync').create('browserSyncACF');
</span><span class='line'>var bslucee = require('browser-sync').create('browserSyncLucee');
</span><span class='line'>
</span><span class='line'>gulp.task('browser-sync', function() {
</span><span class='line'>  bsacf.init({
</span><span class='line'>      proxy: "localhost:8501/myproject",
</span><span class='line'>      browser: "google chrome",
</span><span class='line'>      reloadOnRestart: true
</span><span class='line'>  });
</span><span class='line'>
</span><span class='line'>  bslucee.init({
</span><span class='line'>      proxy: "localhost:8888/myproject",
</span><span class='line'>      browser: "vivaldi",
</span><span class='line'>      port: 3010,
</span><span class='line'>      reloadOnRestart: true,
</span><span class='line'>      ui: {
</span><span class='line'>          port: 3011
</span><span class='line'>      }
</span><span class='line'>  });
</span><span class='line'>
</span><span class='line'>  gulp.watch([
</span><span class='line'>      'controllers/*.cfc', 'services/*.cfc', 'views/**/*.cfm', 'dist/*.css'
</span><span class='line'>  ]).on("change", function() {
</span><span class='line'>      console.log("Watch hit");
</span><span class='line'>      bsacf.reload();
</span><span class='line'>      bslucee.reload();
</span><span class='line'>  });
</span><span class='line'>});
</span><span class='line'>
</span><span class='line'>gulp.task('default', ['browser-sync']);</span></code></pre></td></tr></table></div></figure>


<p>I specify separate browsers for each so that ACF and Lucee sessions don&rsquo;t step on one another, and separate ports for the Lucee instance of Browsersync so they can coexist. The advantage to doing it this way is I can start both instances with a single <em>gulp</em> command on the command line. Unfortunately the ACF and Lucee instances of Browsersync will not mirror or ghost each other, so I will still have to click and enter test data on forms separately while developing, but this is still much better than needing to reload both browsers manually all the time.</p>

<h5>Update:</h5>

<p>I&rsquo;ve noticed one other feature of Browsersync that I wanted to see if I could get working - injecting modified CSS into the browser to avoid reloading the DOM. I&rsquo;ve now rearranged my gulpfile.js to be the following, adding a second gulp.watch() call to inject the minified bootstrap css directly into the browser, and removing the <em>dist</em> directory from the first gulp.watch() call so the browsers are not reloaded.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>var gulp = require('gulp');
</span><span class='line'>var bsacf = require('browser-sync').create('browserSyncACF');
</span><span class='line'>var bslucee = require('browser-sync').create('browserSyncLucee');
</span><span class='line'>
</span><span class='line'>gulp.task('browser-sync', function() {
</span><span class='line'>  bsacf.init({
</span><span class='line'>      proxy: "localhost:8501/easycal",
</span><span class='line'>      browser: "google chrome",
</span><span class='line'>      reloadOnRestart: true
</span><span class='line'>  });
</span><span class='line'>
</span><span class='line'>  bslucee.init({
</span><span class='line'>      proxy: "localhost:8888/easycal",
</span><span class='line'>      browser: "vivaldi",
</span><span class='line'>      port: 3010,
</span><span class='line'>      reloadOnRestart: true,
</span><span class='line'>      ui: {
</span><span class='line'>          port: 3011
</span><span class='line'>      }
</span><span class='line'>  });
</span><span class='line'>
</span><span class='line'>  gulp.watch([
</span><span class='line'>      'controllers/*.cfc', 'services/*.cfc', 'views/**/*.cfm',
</span><span class='line'>      'layouts/**/*.cfm', 'dist/*.css', 'easycal-app.css'
</span><span class='line'>  ]).on("change", function() {
</span><span class='line'>      console.log("Watch hit");
</span><span class='line'>      bsacf.reload();
</span><span class='line'>      bslucee.reload();
</span><span class='line'>  });
</span><span class='line'>
</span><span class='line'>  gulp.watch([
</span><span class='line'>      'dist/toolkit.min.css'
</span><span class='line'>  ]).on("change", function() {
</span><span class='line'>      console.log("CSS hit");
</span><span class='line'>      return gulp.src(['dist/toolkit.min.css'])
</span><span class='line'>          .pipe(bsacf.stream())
</span><span class='line'>          .pipe(bslucee.stream());
</span><span class='line'>  });
</span><span class='line'>});
</span><span class='line'>
</span><span class='line'>gulp.task('default', ['browser-sync']);</span></code></pre></td></tr></table></div></figure>


<p>I like how this is shaping up now. :-)</p>

<p>Comments or suggestions welcome!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/08/05/scale-attribute-is-essential-with-decimal-cfsqltype/">Scale Attribute Is Essential With Decimal Cfsqltype</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-08-05T00:22:47+02:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>5</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>12:22 am</span></time>
        
           | <a href="/blog/2016/08/05/scale-attribute-is-essential-with-decimal-cfsqltype/#disqus_thread"
             data-disqus-identifier="http://dnando.github.io/blog/2016/08/05/scale-attribute-is-essential-with-decimal-cfsqltype/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I just ran across something important to know regarding the cfsqltype cf_sql_decimal. Here&rsquo;s the code I was testing:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>params.insert( 'previousNumericDuration',
</span><span class='line'>  { value: preNDuration, cfsqltype: 'cf_sql_decimal' } );</span></code></pre></td></tr></table></div></figure>


<p>Here&rsquo;s what it would look like if you are using the cfqueryparam tag:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;cfqueryparam value='#preNDuration#' cfsqltype='cf_sql_decimal' /&gt;</span></code></pre></td></tr></table></div></figure>


<p>The database column this is persisted to is defined as a <code>decimal(4,2)</code>, so 2 digits are reserved for the whole number portion of the value and 2 digits reserved for the decimal portion of the value. Logging showed values being calculated such as 4.25 and 4.5, but these were being persisted to the database rounded to the nearest integer, but with 2 decimal places none the less, so 4.25 was persisted as <em>4.00</em> and 4.5 was persisted as <em>5.00</em>. Definitely not what I wanted. What&rsquo;s the point of a decimal datatype if the decimal portion is always 0?</p>

<p>Digging into the documentation for cfqueryparam I found a scale attribute that until today I hadn&rsquo;t realized was absolutely essential to use for decimal fields like this. Scale defines the &hellip; &ldquo;Number of decimal places in parameter. Applies to CF_SQL_NUMERIC and CF_SQL_DECIMAL.&rdquo; Its default is 0, so my values were being rounded to 0 decimal places. After changing my code to the following:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>params.insert( 'previousNumericDuration',
</span><span class='line'>  { value: preNDuration, cfsqltype: 'cf_sql_decimal', scale: 2 } );</span></code></pre></td></tr></table></div></figure>


<p>the decimal portion of the values was then persisted correctly.</p>

<p>So the <em>scale</em> attribute is absolutely essential for a <em>decimal</em> cfsqltype. I might have tripped over this before, I&rsquo;m not sure. Perhaps this blog post will help me remember it next time. Now I should search my code to see if I&rsquo;ve neglected this attribute elsewhere!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/03/22/first-steps-with-the-clojure-version-of-fw-slash-1/">First Steps With the Clojure Version of FW/1</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-03-22T20:45:04+01:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>22</span><span class='date-suffix'>nd</span>, <span class='date-year'>2016</span></span> <span class='time'>8:45 pm</span></time>
        
           | <a href="/blog/2016/03/22/first-steps-with-the-clojure-version-of-fw-slash-1/#disqus_thread"
             data-disqus-identifier="http://dnando.github.io/blog/2016/03/22/first-steps-with-the-clojure-version-of-fw-slash-1/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Sean Corfield has built a Clojure version of the popular CFML framework FW/1. I&rsquo;ve been using FW/1 for a number of years, so I thought it might help me learn Clojure to begin developing an app in fw1-clj.</p>

<p>The first step to get up and running is to head on over to the <a href="https://github.com/framework-one/fw1-clj">fw1-clj GitHub repository</a> and follow the directions to <a href="https://github.com/boot-clj/boot#install">install Boot</a>, which is a build tool for Clojure. Next, as per the instructions on the fw1-clj GitHub repository, we run a boot command in a terminal to create a new fw1-clj app, which currently looks like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>boot -d seancorfield/boot-new new -t fw1 -n myfw1app
</span></code></pre></td></tr></table></div></figure>


<p>(Sean has indicated this invocation may change in the future, so best to follow the fw1-clj repository instructions.)</p>

<p>Then, we &ldquo;cd&rdquo; into the application directory we specified above, in this example &ldquo;myfw1app&rdquo;, and start the application up like so:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">cd </span>myfw1app
</span><span class='line'><span class="nv">PORT</span><span class="o">=</span><span class="m">8111</span> boot run
</span></code></pre></td></tr></table></div></figure>


<p>Specifying the PORT variable isn&rsquo;t required, but may be necessary to avoid conflicts. If omitted, the default port is 8080.</p>

<p>Navigating to localhost:8111, we see a lovely default page that says &ldquo;Framework One - Welcome to FW/1&rdquo;. Yay! It certainly is impressive how easy that is. No server to install. Nothing to download. No settings to find and configure. We&rsquo;re ready to start developing.</p>

<p>There are several options to choose from in terms of an IDE for Clojure. Many experienced Clojure developers use <a href="https://www.gnu.org/software/emacs/">Emacs</a> with <a href="https://github.com/clojure-emacs/cider">CIDER</a>, or the <a href="https://cursive-ide.com/userguide/index.html">Cursive plugin</a> for <a href="https://www.jetbrains.com/idea/download/index.html">Intellij</a>. Both of those have a learning curve that you may prefer to avoid to focus on getting the basics of Clojure down first.</p>

<p>For beginners, good IDE&rsquo;s for experimentation are <a href="http://lighttable.com/">Light Table</a> or <a href="https://atom.io/">Atom</a> with <a href="https://atom.io/packages/search?q=clojure">a few Clojure packages</a> installed, such as language-clojure, proto-repl and parinfer. I&rsquo;m using Atom at the moment because I&rsquo;m also using it for CFML development, and also because the Clojure packages seem to work very well.</p>

<p>One of the first things I wanted to figure out was how to visualize the rc map (or struct as it would be known in CFML). With a tip from Sean, I navigated to src/projectName/controllers/main.clj in the project that boot generated for me, and within the default function definition, I added <code>(println rc)</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">default</span> <span class="s">&quot;/main/default handler&quot;</span> <span class="p">[</span><span class="nv">rc</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">println </span><span class="nv">rc</span><span class="p">)</span>
</span><span class='line'>  <span class="nv">rc</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>reloaded the app in the browser, and then checked the terminal window where I had started the app with the boot command for the output. Nothing was output there. After a moment, I remembered that I probably had to reload the application to get the changes picked up. Checking the somewhat sparse documentation on the Github page, I found the default reload query string would be &ldquo;?reload=secret&rdquo;. Hitting localhost:8111?reload=secret in the browser then generated the rc map in my terminal window - all in one <em>very</em> long line. After another suggestion from Sean, I replaced the print line function <code>(println rc)</code> with the clojure pretty print function  <code>(clojure.pprint/pprint rc)</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">default</span> <span class="s">&quot;/main/default handler&quot;</span> <span class="p">[</span><span class="nv">rc</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">clojure.pprint/pprint</span> <span class="nv">rc</span><span class="p">)</span>
</span><span class='line'>  <span class="nv">rc</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>hit localhost:8111?reload=secret again, and now the keys within the rc map were nicely separated by line breaks in the terminal output. Much more readable that way.</p>

<p>I noticed within the output that the :reload-application-on-every-request key was set to false. Better in development to have that set to true, so reading the docs, I found &ldquo;the call to (fw1/start) can be passed configuration parameters either as a map or as an arbitrary number of inline key / value pairs&rdquo;</p>

<p>Ok, so opening src/projectName/main.clj, I found the call to (fw1/start) and changed it from</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">-main</span> <span class="p">[]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">port</span> <span class="p">(</span><span class="nf">Integer/parseInt</span> <span class="p">(</span><span class="nb">get </span><span class="p">(</span><span class="nf">System/getenv</span><span class="p">)</span> <span class="s">&quot;PORT&quot;</span> <span class="s">&quot;8080&quot;</span><span class="p">))]</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">run-jetty</span> <span class="p">(</span><span class="nf">fw1/start</span> <span class="ss">:application-key</span> <span class="s">&quot;easycalclj&quot;</span><span class="p">)</span>
</span><span class='line'>               <span class="p">{</span><span class="ss">:port</span> <span class="nv">port</span><span class="p">})))</span>
</span></code></pre></td></tr></table></div></figure>


<p>to</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">-main</span> <span class="p">[]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">port</span> <span class="p">(</span><span class="nf">Integer/parseInt</span> <span class="p">(</span><span class="nb">get </span><span class="p">(</span><span class="nf">System/getenv</span><span class="p">)</span> <span class="s">&quot;PORT&quot;</span> <span class="s">&quot;8080&quot;</span><span class="p">))]</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">run-jetty</span> <span class="p">(</span><span class="nf">fw1/start</span> <span class="ss">:application-key</span> <span class="s">&quot;easycalclj&quot;</span> <span class="ss">:reload-application-on-every-request</span> <span class="s">&quot;true&quot;</span><span class="p">)</span>
</span><span class='line'>               <span class="p">{</span><span class="ss">:port</span> <span class="nv">port</span><span class="p">})))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then I reloaded the app with &ldquo;?reload=secret&rdquo;, and the rc output for :reload-application-on-every-request didn&rsquo;t change. Hmmm &hellip;</p>

<p>After a bit of investigation, (I asked Sean again on Slack), I found that to reload changes to the configuration params, I needed to go to the terminal window where I started the app with <code>boot run</code>, shut the app down with <code>control-c</code>, and then start it up again with <code>PORT=8111 boot run</code>.</p>

<p>Checking the rc output in the console again, I saw that :reload-application-on-every-request was now true!</p>

<p>These were all small baby steps, but unless I take them, I won&rsquo;t learn.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/07/01/generating-accurate-pdfs-using-cfdocument/">Generating Accurate PDFs Using Cfdocument</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-07-01T23:55:41+02:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>1</span><span class='date-suffix'>st</span>, <span class='date-year'>2015</span></span> <span class='time'>11:55 pm</span></time>
        
           | <a href="/blog/2015/07/01/generating-accurate-pdfs-using-cfdocument/#disqus_thread"
             data-disqus-identifier="http://dnando.github.io/blog/2015/07/01/generating-accurate-pdfs-using-cfdocument/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&rsquo;ve been developing a PDF, generated within a CFML application, that needs very accurate placement of chunks of text so that it can be printed on a standard form. It also needs to use a specified font, OCR-B, so that a line of text on the printed form can be machine scanned. I&rsquo;ve managed to get this working much better than expected on both ACF and Lucee, in a cross-compatible way, so I thought I&rsquo;d write everything up to remember the details down the line.</p>

<p>I was at first thinking I might be able to use the new cfhtmltopdf tag, but quickly dropped that idea: I couldn&rsquo;t get the PDF Service needed to use this tag to work on my Mac; it seems to be an enterprise only feature; and I wasn&rsquo;t so sure this approach would be compatible to use within Lucee. After looking around over the fence for a bit at potential solutions outside of CFML, nothing hit me as particularly appealing, so I dug into getting cfdocument to work as best I could. First the tag attributes.</p>

<h2>Attributes</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;cfdocument format="pdf" pagetype="A4" orientation="portrait" fontEmbed="true" unit="cm" localUrl="true" saveAsName="#pdfFileName#" marginLeft="0" margintop="0" marginright="0" marginbottom="0"&gt;</span></code></pre></td></tr></table></div></figure>


<p>FontEmbed=&ldquo;true&rdquo; is essential so that anyone can print the PDF with the OCR-B code line correctly displayed, even if they don&rsquo;t have this font on their system. LocalUrl is set to true to easily pull in a logo image from the local file system. Note the margins are set to 0, because I&rsquo;m using a <code>&lt;div&gt;</code> tag to define the size of the page to control the tendency of the 2 different PDF generation engines used in ACF and Lucee to scale the layout, differently.</p>

<h2>Layout</h2>

<p>Nested directly within the cfdocument tag is a div tag that sets the page width, with <code>position:relative</code> so it remains within the page flow, and acts as the parent tag within which all layout divs that position text are nested <em>and proportionally scaled against</em>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;div style="position:relative; top:0mm; left:0mm; width:210mm;"&gt;</span></code></pre></td></tr></table></div></figure>


<p>Then within that parent div tag are nested the various div tags, absolutely positioned, containing the blocks of text and images that make up the PDF content. Here are a few examples to demonstrate:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;div class="address"  style="position:absolute; top:13mm; left:100mm; "&gt;
</span><span class='line'>  #biller.address1# &middot #biller.zipcode# #biller.city#
</span><span class='line'>&lt;/div&gt;
</span><span class='line'>&lt;!--- client address ---&gt;
</span><span class='line'>&lt;div class="text" style="position:absolute; top:45mm; left:130mm"&gt;
</span><span class='line'>  #invoice.getClient().getName()#&lt;br&gt;
</span><span class='line'>  &lt;cfif len( trim( invoice.getClient().getAddress1() ) )&gt;#invoice.getClient().getAddress1()#&lt;br&gt;&lt;/cfif&gt;
</span><span class='line'>  &lt;cfif len( trim( invoice.getClient().getAddress2() ) )&gt;#invoice.getClient().getAddress2()#&lt;br&gt;&lt;/cfif&gt;
</span><span class='line'>  &lt;cfif len( trim( invoice.getClient().getAddress3() ) )&gt;#invoice.getClient().getAddress3()#&lt;br&gt;&lt;/cfif&gt;
</span><span class='line'>  #invoice.getClient().getCountryCode()#-#invoice.getClient().getZipCode()# #invoice.getClient().getCity()#
</span><span class='line'>&lt;/div&gt;</span></code></pre></td></tr></table></div></figure>


<p>What I really like about this approach is that each of the text blocks winds up very close to the top and left dimensions specified, and the ACF and Lucee outputs are nearly identical.</p>

<p>Without the parent div tag specifying the width, the results between the 2 engines are vastly different, and positioning the elements is much more a question of trial and error than simply entering the top and left positions as measured with a ruler (and perhaps tweaking them by a few milimeters if necessary). Also without the parent div tag to control how layout elements scale, changing the dimension of one absolutely positioned div within the PDF can easily alter the position or size of other divs, which can be very frustrating if you have 20 or 30 elements that all need to be precisely positioned.</p>

<p>Feel free to experiment with paddings or margins on the parent div if you want - I suspect it would work just as well (but haven&rsquo;t tried). For myself, I found it easier simply to measure placement from the edge of the page.</p>

<p>I haven&rsquo;t tried this myself, yet, but I have it from a reliable source that a parent div tag in the layout specifying the page width, as above, will fix page break issues if a table extends over more than one page.</p>

<h2>Fonts</h2>

<p>Specifying a font for a block of text is simple. You can use a CSS style declaration within a style block that is nested <em>within</em> the cfdocument tag, or you can place the font specification directly in a style attribute of an html tag like `<div> <span> <td>. Here are the styles I used for the above text blocks (and again, the style block must be nested within the cfdocument tag, or the PDF generator won&rsquo;t see it):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;cfdocument format="pdf" pagetype="A4" orientation="portrait" fontEmbed="true" unit="cm" localUrl="true" saveAsName="#pdfFileName#" marginLeft="0" margintop="0" marginright="0" marginbottom="0"&gt;
</span><span class='line'>&lt;style&gt;
</span><span class='line'>  div.text {
</span><span class='line'>      font: 9pt Arial;
</span><span class='line'>      line-height: 13pt;
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  div.address {
</span><span class='line'>      font: 9pt Arial;
</span><span class='line'>      color: #033B7D;
</span><span class='line'>  }
</span><span class='line'>  ...
</span><span class='line'>&lt;/style&gt;
</span></code></pre></td></tr></table></div></figure>


<p>As of this writing, available CSS attributes remain limited. There is a list of CSS attributes that work in the ACF documentation for cfdocument, reproduced here:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>The cfdocument tag supports the following CSS styles:
</span><span class='line'>
</span><span class='line'>background
</span><span class='line'>background-attachment
</span><span class='line'>background-color
</span><span class='line'>background-image
</span><span class='line'>background-position
</span><span class='line'>background-repeat
</span><span class='line'>border
</span><span class='line'>border-bottom
</span><span class='line'>border-bottom-color
</span><span class='line'>border-bottom-style (solid border only)
</span><span class='line'>border-bottom-width
</span><span class='line'>border-color
</span><span class='line'>border-left
</span><span class='line'>border-left-color
</span><span class='line'>border-left-style (solid border only)
</span><span class='line'>border-left-width
</span><span class='line'>border-right
</span><span class='line'>border-right-color
</span><span class='line'>border-right-style (solid border only)
</span><span class='line'>border-right-width
</span><span class='line'>border-spacing
</span><span class='line'>border-style (solid border only)
</span><span class='line'>border-top
</span><span class='line'>border-top-color
</span><span class='line'>border-top-style (solid border only)
</span><span class='line'>border-top-width
</span><span class='line'>border-width
</span><span class='line'>bottom
</span><span class='line'>clear
</span><span class='line'>clip
</span><span class='line'>color
</span><span class='line'>content (strings, counters only)
</span><span class='line'>counter-increment
</span><span class='line'>counter-reset
</span><span class='line'>cursor
</span><span class='line'>display
</span><span class='line'>float
</span><span class='line'>font
</span><span class='line'>font-family
</span><span class='line'>font-size
</span><span class='line'>font-style
</span><span class='line'>font-weight
</span><span class='line'>height
</span><span class='line'>left
</span><span class='line'>letter-spacing
</span><span class='line'>line-height
</span><span class='line'>list-style-type
</span><span class='line'>margin
</span><span class='line'>margin-bottom
</span><span class='line'>margin-left
</span><span class='line'>margin-right
</span><span class='line'>margin-top
</span><span class='line'>outline
</span><span class='line'>outline-color
</span><span class='line'>outline-style (solid, dotted, dashed only)
</span><span class='line'>outline-width
</span><span class='line'>padding
</span><span class='line'>padding-bottom
</span><span class='line'>padding-left
</span><span class='line'>padding-right
</span><span class='line'>padding-top
</span><span class='line'>page-break-after
</span><span class='line'>page-break-before
</span><span class='line'>page-break-inside
</span><span class='line'>position
</span><span class='line'>right
</span><span class='line'>text-align (left, right, and center)
</span><span class='line'>text-decoration
</span><span class='line'>text-indent
</span><span class='line'>top
</span><span class='line'>unicode-bidi
</span><span class='line'>vertical-align
</span><span class='line'>visibility
</span><span class='line'>white space (normal, nowrap only)
</span><span class='line'>width
</span><span class='line'>z-index</span></code></pre></td></tr></table></div></figure>


<h2>Custom fonts</h2>

<p>Scattered around the internet I found a variety of comments suggesting that getting a &ldquo;custom&rdquo; font to work within cfdocument isn&rsquo;t at all easy. Once you know how, it&rsquo;s actually fairly simple. For both ACF and Lucee, it&rsquo;s a question of getting the correct font file in the right place, with the right permissions, and restarting ACF/Lucee.</p>

<p>For ACF, log into the administrator and go to the Font Management Panel. There you will see all the fonts available to use in cfdocument &hellip; except that as of this writing, the OTF fonts won&rsquo;t work, even tho&#8217; the Font Management panel claims they are useable in PDFs. Unless something changes in the future, forget OTF fonts for cfdocument. I tried a bunch that already seemed to be recognized, none worked.</p>

<p>At the top of the font panel, you&rsquo;ll see a feature that allows you to add fonts &ldquo;Register New Font(s) with ColdFusion&rdquo;. I couldn&rsquo;t get this to work reliably - I think the validation routine on it isn&rsquo;t well designed. Go ahead and try if you like, but I found it easier to simply find a path to a font directory already recognized by ACF from the list of fonts installed ( I chose a directory with TTF files, just to be sure ), copy the TTF font files you want to use to that directory, change the owner/group and permissions to match the other font files in that directory (if necessary on your OS), restart ACF, log back into the administrator, go to the Font Management panel again and look for your fonts. In the left columns of the font table there are 3 names, Font Family, Font Face, Postscript Name. From my experience, using the font face name in your CSS specification should work. ( If not, try the other names - I saw a post suggesting that. )</p>

<p>To be clear, after you get the font installed in a directory that ACF recognizes as a font directory, one way or another, you&rsquo;ll need to find the name you need to use in your CSS. The file name often does not match the font name.</p>

<p>For Lucee, the process is different. ;-) Go to your Lucee installation directory, and within the /lib/ directory underneath it, find the fonts.jar file. Copy it to a working directory, rename the copy to fonts.zip and unzip it. ( A .jar file is essentially a ZIP file ). In the unzipped <em>fonts</em> directory that results, add your custom font files, again use only TTFs, and then open the pd4fonts.properties file you find in there and following the pattern you see, add the names of the fonts. In Lucee, you can choose the name, but to be cross compatible with ACF, I used the same name that ACF picked up from the font file. Here&rsquo;s what my pd4fonts.properties looked like after I added the OCR-B font I needed:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#this is an autogenerated file. please remove manually any references to copyrighted fonts
</span><span class='line'>#Fri Apr 17 20:00:52 CEST 2009
</span><span class='line'>Arial=arial.ttf
</span><span class='line'>Arial\ Bold=arialbd.ttf
</span><span class='line'>Arial\ Bold\ Italic=arialbi.ttf
</span><span class='line'>Arial\ Italic=ariali.ttf
</span><span class='line'>Courier\ New=cour.ttf
</span><span class='line'>Courier\ New\ Bold=courbd.ttf
</span><span class='line'>Courier\ New\ Bold\ Italic=courbi.ttf
</span><span class='line'>Courier\ New\ Italic=couri.ttf
</span><span class='line'>Times\ New\ Roman=times.ttf
</span><span class='line'>Times\ New\ Roman\ Bold=timesbd.ttf
</span><span class='line'>Times\ New\ Roman\ Bold\ Italic=timesbi.ttf
</span><span class='line'>Times\ New\ Roman\ Italic=timesi.ttf
</span><span class='line'>OCRB=ob______.ttf
</span></code></pre></td></tr></table></div></figure>


<p>I added the last line, <code>OCRB=ob______.ttf</code>, following the pattern <code>FontFaceName=fontFileName.ttf</code>.</p>

<p>Note that spaces in the font name are escaped with backslashes, so those look like this <code>Font\ Face\ Name=fontFileName.ttf</code>.</p>

<p>Ok, save pd4fonts.properties when you&rsquo;re done, zip the fonts directory up into fonts.zip, rename it to fonts.jar, copy it back where it came from in the /lib/ directory, overwriting &hellip; no wait! Don&rsquo;t just overwrite the old fonts.jar. Keep a copy of it, just in case &hellip; replace the old fonts.jar with the new fonts.jar, change the owner/group permissions to match the old file, and then restart Lucee.</p>

<p>The name to use in your CSS for the font is the name you placed in the pd4fonts.properties file.</p>

<p>Of course, the above approach for Lucee ( 4.5 ) might certainly change in the future. But for now, it works like this.</p>

<p>A big thanks to <a href="http://blog.hnat.de/post.cfm/schriftarten-zu-railo-hinzufugen">Michael Hnat</a> for pointing me in the right direction regarding Lucee with his very helpful blog post.</p>

<h2>Images</h2>

<p>There is a logo image at the top of this PDF that was scaling up when rendered in Lucee in a way that caused it to be misplaced. The top left position was correct, but it was about 50% too big, pixelated, and overran other text. After a bunch of reading that indicated modifying the image print size or resolution would not help, I tried adding a css style declaration to the image that specified a size in mm, and it worked! Thanks to faxi05 for the suggestion.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;img src="logos/imageName.png" style="width:78mm; height:14mm" /&gt;
</span></code></pre></td></tr></table></div></figure>


<p>&hellip; and it&rsquo;s cross compatible with ACF!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/06/16/cfml-queries-in-script/">CFML Queries in Script</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-06-16T18:39:54+02:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>16</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>6:39 pm</span></time>
        
           | <a href="/blog/2015/06/16/cfml-queries-in-script/#disqus_thread"
             data-disqus-identifier="http://dnando.github.io/blog/2015/06/16/cfml-queries-in-script/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Recently, I needed to write a somewhat complex query with a conditional where clause. I resisted the urge to revert to the cfquery tag for this sort of thing, and came up with the following using queryExecute(), submitted as an example without explanation. This approach works on both ACF and Lucee.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public query function findRawAudit( string entity, numeric userId, date dateFrom, date dateTo, numeric timeZoneOffset ) {
</span><span class='line'>  var newLine = CHR(13) & CHR(10);
</span><span class='line'>  var params = {};
</span><span class='line'>  var sql = "
</span><span class='line'>      select a.entity, a.entityId, a.timestamp, a.transaction, a.attribute, a.value as previousValue, u.name as username, null as currentValue, null as auditName, null as asql
</span><span class='line'>      from Audit a inner join User u
</span><span class='line'>      on a.userId = u.userId
</span><span class='line'>      where 0=0
</span><span class='line'>  ";
</span><span class='line'>
</span><span class='line'>  if ( structKeyExists(arguments, 'entity') and len( arguments.entity ) ) {
</span><span class='line'>      sql &= newLine & "and entity = :entity";
</span><span class='line'>      structInsert(params, "entity", { value: arguments.entity, cfsqltype: "cf_sql_varchar" } );
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  if ( structKeyExists(arguments, 'userId') ) {
</span><span class='line'>      sql &= newLine & "and a.userId = :userId";
</span><span class='line'>      structInsert(params, "userId", { value: arguments.userId, cfsqltype: "cf_sql_integer" } );
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  if ( structKeyExists(arguments, 'dateFrom') ) {
</span><span class='line'>      sql &= newLine & "and timestamp &gt; :dateFrom";
</span><span class='line'>      //  adjust dateFrom to account for time zone difference between server and user
</span><span class='line'>      var dateFromUTC = DateAdd( 'h', -arguments.timeZoneOffset, arguments.dateFrom );
</span><span class='line'>      structInsert(params, "dateFrom", { value: arguments.dateFrom, cfsqltype: "cf_sql_timestamp" } );
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  if ( structKeyExists(arguments, 'dateTo') ) {
</span><span class='line'>      sql &= newLine & "and timestamp &lt; :dateTo";
</span><span class='line'>      //  adjust dateFrom to account for time zone difference between server and user
</span><span class='line'>      var dateToUTC = DateAdd( 'h', -arguments.timeZoneOffset, arguments.dateTo );
</span><span class='line'>      // we add a day to dateTo to arrive at an effectiveEndDateTime, namely midnight of the endDate
</span><span class='line'>      // so that the endDate is inclusive, as users would very likely expect
</span><span class='line'>      dateToUTC = dateAdd( 'd', 1, dateToUTC );
</span><span class='line'>      // stdout.println( "dateToUTC : #dateToUTC #" );
</span><span class='line'>      structInsert(params, "dateTo", { value: dateToUTC, cfsqltype: "cf_sql_timestamp" } );
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  sql &= newLine & "and a.attribute != 'version' ";
</span><span class='line'>
</span><span class='line'>  sql &= newLine & "and a.attribute != 'lastEdited' ";
</span><span class='line'>
</span><span class='line'>  sql &= newLine & "and a.attribute != 'userId' ";
</span><span class='line'>
</span><span class='line'>  sql &= newLine & "order by a.timestamp desc, a.transaction";
</span><span class='line'>
</span><span class='line'>  return queryExecute( sql, params );
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>


<p>Thanks to Igal Sapir for helping me work this out!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/06/16/debugging-technique-cfml-development/">Debugging Technique CFML Development</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-06-16T17:01:52+02:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>16</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>5:01 pm</span></time>
        
           | <a href="/blog/2015/06/16/debugging-technique-cfml-development/#disqus_thread"
             data-disqus-identifier="http://dnando.github.io/blog/2015/06/16/debugging-technique-cfml-development/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I learned a debugging techique from Sean Corfield recently that I think is well worth sharing more widely. It works just as well for Lucee, Railo or Adobe Coldfusion. Here&rsquo;s what he reccommends:</p>

<blockquote><p>For ease of debugging any problems that may occur, I strongly recommend you always keep a Terminal / Console window open containing a tail of the console output from your CFML server. If you’re using Lucee or a Railo installation based on Tomcat, you’ll want to find the catalina.out log file and tail that. If you’re using ColdFusion 11, even tho’ it is notionally based on Tomcat, it’s completely non-standard and you’ll want to tail cfusion/logs/coldfusion-out.log.</p><footer><strong>Sean Corfield</strong> <cite><a href='https://framework-one.github.io/documentation/3.5/cfml-and-clojure.html'>framework-one.github.io/3.5/&hellip;</a></cite></footer></blockquote>


<p>To &ldquo;tail&rdquo;, in this case, means to show the newly added contents of a log file in real time. To get this to work, I open Terminal on my Mac and issue the following commands:</p>

<p> &hellip; for my local CF11 install:</p>

<pre><code class="`"> tail -f /Applications/ColdFusion11/cfusion/logs/coldfusion-out.log
</code></pre>

<p>  and for my local Lucee install:</p>

<pre><code class="``">  tail -f ~/tomcat/logs/catalina.out
</code></pre>

<p>  You will of course need to change those paths to match the directory under which your applications are installed.</p>

<p>  To get out of tail mode and back to the command line, hit CTRL-C.</p>

<p>  What I see when I do this is the last 10 lines of the log file, to start with. Anytime an additional line is added to the log file, it immediately appears in the console display in real time.</p>

<p>  Now what I can do in my code is send output to these log files. An example should explain it sufficiently. I just used this technique to debug a the following service function, where I wanted to ensure that dateTo UTC was being set as needed:</p>

<pre><code class="``">    public query function findRawAudit( string entity, numeric userId, date dateFrom, date dateTo, numeric timeZoneOffset ) {
        var stdout = createObject( "java", "java.lang.System" ).out;

        ...

        if ( structKeyExists(arguments, 'dateTo') ) {
            sql &amp;= "#newLine#" &amp; "and timestamp &lt; :dateTo";
            //  adjust dateFrom to account for time zone difference between server and user
            var dateToUTC = DateAdd( 'h', -arguments.timeZoneOffset, arguments.dateTo );
            // we add a day to dateTo to arrive at an effectiveEndDateTime, namely midnight of the endDate
            // so that the endDate is inclusive, as users would very likely expect
            dateToUTC = dateAdd( 'd', 1, dateToUTC );
            stdout.println( "dateToUTC : #dateToUTC #" );
            structInsert(params, "dateTo", { value: dateToUTC, cfsqltype: "cf_sql_timestamp" } );
        }
        ...
    }
</code></pre>

<p>Note the lines <code>var stdout = createObject( "java", "java.lang.System" ).out;</code> and <code>stdout.println( "dateToUTC : #dateToUTC #" );</code> which creates an instance of java.lang.System.out and prints a line to the log file.</p>

<p>Immediately upon running this code <code>dateToUTC : {ts '2015-06-16 22:00:00'}</code> appeared in my tail output, which is what I expected. The bug was elsewhere, . I find this very useful. It&rsquo;s simple and effective, and it works in the same way across ACF, Lucee and Railo. I don&rsquo;t have to fiddle around with an admin setting to turn on trace output, check if trace output is enabled, remember the syntax used for cftrace / trace, and I can use it directly on a production server in a pinch in case of need.</p>

<p>Of course, you can tail any log file necessary, or use WriteLog() if you prefer. WriteLog() does the exact same thing as stdout.println(), and it&rsquo;s easier to remember. So taking the above example, I could also use</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>WriteLog( "dateToUTC : #dateToUTC #" );</span></code></pre></td></tr></table></div></figure>


<p>or</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>WriteLog( "dateToUTC : "  & dateToUTC );</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/15/nginx-tweaks-using-proxy-redirect-and-rewrite-directives/">Nginx Tweaks Using Proxy_redirect and Rewrite Directives</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-15T13:05:56+01:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>15</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>1:05 pm</span></time>
        
           | <a href="/blog/2015/01/15/nginx-tweaks-using-proxy-redirect-and-rewrite-directives/#disqus_thread"
             data-disqus-identifier="http://dnando.github.io/blog/2015/01/15/nginx-tweaks-using-proxy-redirect-and-rewrite-directives/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I ran across a few niggles in setting up ColdFusion and Lucee behind a Nginx web server, and thought it might be helpful to document the solutions I came to.</p>

<p>The first small problem was that when users logged out of an FW/1 app, they would encounter a blank screen rather than being redirected to the login screen. Further investigation, using Chrome&rsquo;s Developer Tools Network panel, showed that Nginx was returning a blank location response header on the redirect to the login screen. I&rsquo;m still not exactly clear why this is occuring - other 302 redirects within the app work as expected, but the solution I came up with worked like a charm. All I needed to do was use the proxy_redirect directive alongside the proxy_pass directive, redirecting a blank location to the root location, like so:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>proxy_redirect '' /;</span></code></pre></td></tr></table></div></figure>


<p>I was happy that it worked as I guessed it would. In any case, proxy_redirect is a handy directive to have in your toolkit.</p>

<p>In another case, a url pointing to a directory without a trailing slash would result in a 404 error behind Nginx. This url was being processed using the proxy_pass directive. For example, <a href="http://domain.com/directory">http://domain.com/directory</a> would result in a 404 while <a href="http://domain.com/directory/">http://domain.com/directory/</a> works, locating the default index.cfm template under /directory.</p>

<p>Since I had only one url to adjust, the solution was rather simple:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rewrite ^/directory$ /directory/ redirect;</span></code></pre></td></tr></table></div></figure>


<p>There are several trailing slash issues using Nginx that need to be taken into account. Search for &ldquo;nginx trailing slash&rdquo; to get a handle on them.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/15/utf-8-extended-character-file-names-in-railo/">UTF-8 Extended Character File Names in Railo / Lucee</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-15T13:04:08+01:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>15</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>1:04 pm</span></time>
        
           | <a href="/blog/2015/01/15/utf-8-extended-character-file-names-in-railo/#disqus_thread"
             data-disqus-identifier="http://dnando.github.io/blog/2015/01/15/utf-8-extended-character-file-names-in-railo/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I ran into an issue when porting an application from ACF9 to Railo 4.2 where Railo could not find files that use extented characters in file names, namely letters with accents, umlauts and such. The  request would error out with a template not found error. I briefly considered renaming a bunch of files that my clients had uploaded, building a system to filter out and rename all files with extended characters in them, but decided there has to be a better way. And indeed there is!</p>

<p>Specifically on a Linux or Mac OS, open setenv.sh, which should be located under <railo install directory>/tomcat/bin/ and add the following line at the end of the file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>export LC_CTYPE="en_US.UTF-8"</span></code></pre></td></tr></table></div></figure>


<p>Restart Railo, and you should be good to go!</p>

<p>The background here is that the default file encoding system used in tomcat isn&rsquo;t utf-8. There should be Tomcat documentation available for a Windows install somewhere. Feel free to add a comment if you happen to know how to set the file system encoding on Windows.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/09/testing-nginx-config-directives/">Testing Nginx Config Directives</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-09T11:50:19+01:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>9</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>11:50 am</span></time>
        
           | <a href="/blog/2015/01/09/testing-nginx-config-directives/#disqus_thread"
             data-disqus-identifier="http://dnando.github.io/blog/2015/01/09/testing-nginx-config-directives/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>After setting up both Lucee and ColdFusion web apps behind Nginx, I wanted to prove to myself that the configuration was functioning how I thought it should. The apps worked, but there were several issues I was concerned about.</p>

<p>Here&rsquo;s the configuration I wanted to test:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>upstream    cf_servers {
</span><span class='line'>  server          127.0.0.1:8500;
</span><span class='line'>  keepalive       32; ## number of upstream connections to keep alive
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>server {
</span><span class='line'>  server_name     domain.com;
</span><span class='line'>  listen          80;
</span><span class='line'>  root            /var/sites/domain-com;
</span><span class='line'>
</span><span class='line'>  location ~* \.(?:ico|css|js|gif|jpe?g|png)$ {
</span><span class='line'>      add_header Pragma public;
</span><span class='line'>      add_header Cache-Control "public, must-revalidate, proxy-revalidate";
</span><span class='line'>      gzip  on;
</span><span class='line'>      gzip_http_version 1.0;
</span><span class='line'>      gzip_vary on;
</span><span class='line'>      gzip_comp_level 6;
</span><span class='line'>      gzip_proxied any;
</span><span class='line'>      gzip_types text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript;
</span><span class='line'>      gzip_buffers 16 8k;
</span><span class='line'>      # Disable gzip for certain browsers.
</span><span class='line'>      gzip_disable ~@~\MSIE [1-6].(?!.*SV1)~@~];
</span><span class='line'>      expires modified +90d;
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  location / {
</span><span class='line'>      proxy_pass  http://cf_servers/domain.com/;
</span><span class='line'>      proxy_redirect '' /;
</span><span class='line'>      proxy_http_version  1.1;
</span><span class='line'>      proxy_set_header    Connection "";
</span><span class='line'>      proxy_set_header    Host                $host;
</span><span class='line'>      proxy_set_header    X-Forwarded-Host    $host;
</span><span class='line'>      proxy_set_header    X-Forwarded-Server  $host;
</span><span class='line'>      proxy_set_header    X-Forwarded-For     $proxy_add_x_forwarded_for;     ## CGI.REMOTE_ADDR
</span><span class='line'>      proxy_set_header    X-Forwarded-Proto   $scheme;                        ## CGI.SERVER_PORT_SECURE
</span><span class='line'>      proxy_set_header    X-Real-IP           $remote_addr;
</span><span class='line'>      expires             epoch;
</span><span class='line'>  }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>First off, I had a doubt regarding how Nginx was selecting which location directive to use for each file requested from the documentation I&rsquo;ve read. What I wanted to ensure is that Nginx was serving the static files, and proxying only the CFML files.</p>

<p>A deeper issue here is whether or not the proxy_pass directive contains a URI. If it does, you can&rsquo;t use a regex to filter a location for CFML files only. A few examples will explain this better:</p>

<p>This configuration contains a URI in the proxy_pass directive, namely <strong>/domain.com/</strong>. You cannot use a regex in the location directive to filter the request, so in my case, the location directive simply had to point to the root ( recursively in the way Nginx works, so essentially this directive will process any file under the root ).</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>location / {
</span><span class='line'>  proxy_pass  http://cf_servers/domain.com/;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>This configuration also contains a URI in the proxy_pass directive, the trailing slash. Again, no regex in the location is possible.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>location / {
</span><span class='line'>  proxy_pass  http://cf_servers/;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>This config does not have a URI component in the proxy_pass directive, no trailing slash and no subdirectory are present here. In this case, we CAN apply a regex filter to pass only those files we want to our application server.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>location ~ \.(cfm|cfc|cfml)$ {
</span><span class='line'>  proxy_pass  http://cf_servers;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>The tradeoff here is that if we use a filter to ensure only CFML files are pass to our app server, then we need to additionally configure each virtual host in Tomcat&rsquo;s server.xml ( assuming multiple hosts per server ) so that Tomcat can locate the files.</p>

<p>If you&rsquo;d rather configure each server only in Nginx, as I did with my CF11 install, then another approach might be to use a regex to filter all your static files. Hence:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>location ~* \.(?:ico|css|js|gif|jpe?g|png)$ {
</span><span class='line'>  ...
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>With the essential background information out of the way, the question that arose was this. Is Nginx actually serving the static files, as I hoped, or are they all being passed to ColdFusion? The documention I found here and there seemed contradictory.</p>

<p>Here&rsquo;s one way to test this using curl on the command line to fetch the response headers, with the output I got using the above settings:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ curl -X GET -I http://domain.com/index.cfm
</span><span class='line'>HTTP/1.1 200 OK
</span><span class='line'>Server: nginx
</span><span class='line'>Date: Thu, 08 Jan 2015 21:48:26 GMT
</span><span class='line'>Content-Type: text/html;charset=UTF-8
</span><span class='line'>Transfer-Encoding: chunked
</span><span class='line'>Connection: keep-alive
</span><span class='line'>Set-Cookie: CFID=20071; Expires=Sat, 31-Dec-2044 21:48:26 GMT; Path=/; HttpOnly
</span><span class='line'>Set-Cookie: CFTOKEN=8ff3e8f3dde25bcd-F33324A1-AEBC-7E8D-FEEEB610DD6412E7; Expires=Sat, 31-Dec-2044 21:48:26 GMT; Path=/; HttpOnly
</span><span class='line'>Cache-Control: no-cache
</span><span class='line'>Pragma: no-cache
</span><span class='line'>Expires: Thu, 01 Jan 1970 00:00:01 GMT
</span><span class='line'>X-Frame-Options: SAMEORIGIN
</span><span class='line'>X-Content-Type-Options: nosniff
</span><span class='line'>X-XSS-Protection: 1; mode=block
</span><span class='line'>
</span><span class='line'>$ curl -X GET -I http://domain.com/images/some_logo.gif
</span><span class='line'>HTTP/1.1 200 OK
</span><span class='line'>Server: nginx
</span><span class='line'>Date: Thu, 08 Jan 2015 21:50:12 GMT
</span><span class='line'>Content-Type: image/gif
</span><span class='line'>Content-Length: 10220
</span><span class='line'>Last-Modified: Thu, 11 Dec 2014 17:18:36 GMT
</span><span class='line'>Connection: keep-alive
</span><span class='line'>ETag: "5489d1ec-27ec"
</span><span class='line'>Expires: Wed, 11 Mar 2015 17:18:36 GMT
</span><span class='line'>Cache-Control: max-age=5340504
</span><span class='line'>Pragma: public
</span><span class='line'>Cache-Control: public, must-revalidate, proxy-revalidate
</span><span class='line'>Accept-Ranges: bytes
</span></code></pre></td></tr></table></div></figure>


<p>See the difference? The image is being cached on the browser and the headers are being set as per the static file location block, while index.cfm isn&rsquo;t being cached. The <code>expires epoch;</code> directive tells the browser to set the expires date to 01 Jan 1970, a date in the past means don&rsquo;t cache this, while the <code>expires modified +90d;</code> tells the browser to set the expires date 90 days from the Last-Modified date.</p>

<p>Another way to see these headers is via Developer Tools in Chrome ( or a comparable tool in any other modern browser ). Open a Dev Tools window while browsing the web page you&rsquo;d like to check, refresh the page, go to the Network tab, and click on any file to see the headers. This approach will give you a better overview of how your Nginx settings are serving and caching each file involved in an http request.</p>

<p>After some thought and study, I decided to change my initial approach to caching static content to one that will help guarentee any content that I modify is served fresh from the server rather that stale from the cache. Here&rsquo;s what I came up with, for now, for a particular business application that I am still developing:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>location ~* \.(?:ico|css|js|gif|jpe?g|png)$ {
</span><span class='line'>  add_header Pragma public;
</span><span class='line'>  add_header Cache-Control "public, must-revalidate, proxy-revalidate, max-age=86400";
</span><span class='line'>  etag on;
</span><span class='line'>  gzip  off;
</span><span class='line'>    expires +1d;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>The users who access this site every day will only need to re-download static content once a day, an additional second or two once a day won&rsquo;t hurt them. In the version of Nginx I&rsquo;m currently using, enabling gzip disables etags. For now, I&rsquo;d rather have etag enabled, so I&rsquo;m disabling gzip for static content, but leaving it enabled for the dynamically generated content that is returned from the proxied app server.</p>

<p>Resources for further reading:</p>

<ol>
<li><a href="https://www.mnot.net/cache_docs/">https://www.mnot.net/cache_docs/</a></li>
<li><a href="http://en.wikipedia.org/wiki/HTTP_ETag">http://en.wikipedia.org/wiki/HTTP_ETag</a></li>
<li><a href="http://stackoverflow.com/questions/499966/etag-vs-header-expires">http://stackoverflow.com/questions/499966/etag-vs-header-expires</a></li>
<li><a href="http://stackoverflow.com/questions/5799906/what-s-the-difference-between-expires-and-cache-control-headers">http://stackoverflow.com/questions/5799906/what-s-the-difference-between-expires-and-cache-control-headers</a></li>
<li><a href="https://www.owasp.org/index.php/List_of_useful_HTTP_headers">https://www.owasp.org/index.php/List_of_useful_HTTP_headers</a></li>
<li><a href="http://cyh.herokuapp.com/cyh">http://cyh.herokuapp.com/cyh</a></li>
</ol>

</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/2">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2017/04/09/cfqueryparam-setting-for-sql-in-statements/">Cfqueryparam Setting for SQL &#8216;in&#8217; Statements</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/03/20/hot-browser-reloading/">Hot Browser Reloading With Browsersync</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/08/05/scale-attribute-is-essential-with-decimal-cfsqltype/">Scale Attribute Is Essential With Decimal Cfsqltype</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/03/22/first-steps-with-the-clojure-version-of-fw-slash-1/">First Steps With the Clojure Version of FW/1</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/01/generating-accurate-pdfs-using-cfdocument/">Generating Accurate PDFs Using Cfdocument</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/dnando">@dnando</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'dnando',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2017 - Nando @ Aria Media -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'nandoariamedia';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
